># Q: What needs to be done to this cell?

```py
# 2.2.8 | Type Summary Visualization (optional)
print("\n2.2.8 üìä Type summary visualization")

# Reload registry (so 2.2.8 can run standalone after 2.2.7)
fg_registry_path = SEC2_REPORTS_DIR / "feature_group_registry.csv"
if not fg_registry_path.exists():
    raise FileNotFoundError(
        f"‚ùå feature_group_registry.csv not found at {fg_registry_path}. "
        "Run 2.2.7 first."
    )

feature_group_df = pd.read_csv(fg_registry_path)

try:
    import matplotlib.pyplot as plt
except ImportError as e:
    raise ImportError("matplotlib is required for 2.2.8 plots.") from e

# Determine output figures directory
if "FIGURES_DIR" in globals():
    fig_dir_228 = FIGURES_DIR / "section2"
else:
    fig_dir_228 = SEC2_REPORTS_DIR / "figures"

fig_dir_228.mkdir(parents=True, exist_ok=True)


# Simple bar chart: counts by feature_group
fg_counts = (
    feature_group_df["feature_group"]
    .fillna("unknown")
    .value_counts()
    .sort_values(ascending=False)
)

# display counts
print("\nüìä 2.2.8 feature group counts:")
if not fg_counts.empty:
    display(fg_counts.rename("n_columns").to_frame())
else:
    print("   (no feature groups to plot)")

fig, ax = plt.subplots(figsize=(8, 4))
ax.bar(fg_counts.index, fg_counts.values)
ax.set_title("Feature Group Distribution (Section 2.2)")
ax.set_xlabel("Feature group")
ax.set_ylabel("Number of columns")
ax.set_xticklabels(fg_counts.index, rotation=45, ha="right")
plt.tight_layout()

type_dist_path = fig_dir_228 / "type_distribution_by_feature_group.png"
fig.savefig(type_dist_path, dpi=150)
plt.close(fig)

print(f"üíæ Wrote type distribution plot ‚Üí {type_dist_path}")

n_feature_groups_228 = int(feature_group_df["feature_group"].nunique())

summary_228 = {
    "section":            "2.2.8",
    "section_name":       "Type summary visualization",
    "check":              "Plot distribution of column types and feature groups",
    "level":              "info",
    "status":             "INFO",  # visualization-only
    "n_feature_groups":   n_feature_groups_228,
    "detail":             f"type_distribution_by_feature_group.png under {fig_dir_228}",
    "timestamp":          pd.Timestamp.utcnow(),
}

if "_append_sec2" in globals():
    _append_sec2(pd.DataFrame([summary_228]))
else:
    path = SECTION2_REPORT_PATH
    tmp = path.with_suffix(path.suffix + ".tmp")
    chunk = pd.DataFrame([summary_228])
    try:
        path.parent.mkdir(parents=True, exist_ok=True)
        if path.exists():
            ex = pd.read_csv(path)
            allc = pd.Index(ex.columns).union(chunk.columns)
            out = pd.concat(
                [ex.reindex(columns=allc), chunk.reindex(columns=allc)],
                ignore_index=True,
            )
        else:
            out = chunk
        out.to_csv(tmp, index=False)
        os.replace(tmp, path)
        print(f"üßæ Appended 2.2.8 summary ‚Üí {path}")
    except Exception as e:
        if tmp.exists():
            try:
                tmp.unlink()
            except Exception:
                pass
        print(f"‚ö†Ô∏è Could not append 2.2.8 summary: {e}")

print("‚úÖ 2.2.8 complete.")

# OUTPUT:
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_columns</th>
    </tr>
    <tr>
      <th>feature_group</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>categorical_nominal</th>
      <td>16</td>
    </tr>
    <tr>
      <th>numeric_continuous</th>
      <td>8</td>
    </tr>
    <tr>
      <th>binary</th>
      <td>3</td>
    </tr>
    <tr>
      <th>datetime</th>
      <td>2</td>
    </tr>
    <tr>
      <th>numeric_discrete</th>
      <td>1</td>
    </tr>
    <tr>
      <th>id</th>
      <td>1</td>
    </tr>
    <tr>
      <th>target</th>
      <td>1</td>
    </tr>
    <tr>
      <th>target_aux</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

/var/folders/dn/wtcqyjbd1hn63s40771sdddm0000gn/T/ipykernel_54139/2648077449.py:48: UserWarning: set_ticklabels() should only be used with a fixed number of ticks, i.e. after set_ticks() or using a FixedLocator.
  ax.set_xticklabels(fg_counts.index, rotation=45, ha="right")
üíæ Wrote type distribution plot ‚Üí /Users/b/DATA/PROJECTS/Telco/Level_3/resources/figures/section2/type_distribution_by_feature_group.png
üßæ Appended 2.2.8 summary ‚Üí /Users/b/DATA/PROJECTS/Telco/Level_3/resources/reports/section2/section2_data_quality_20251209_181006.csv
‚úÖ 2.2.8 complete.
```

># SOLUTION:
Good news: this cell is basically doing the right thing. You just have **two tiny polish fixes**:

---

## 1Ô∏è‚É£ Fix the Matplotlib `set_ticklabels` warning

The warning:

> `UserWarning: set_ticklabels() should only be used with a fixed number of ticks...`

comes from this line:

```python
ax.set_xticklabels(fg_counts.index, rotation=45, ha="right")
```

Matplotlib doesn‚Äôt like `set_xticklabels` without explicitly fixing the tick positions first.

### Minimal fix

Right before `plt.tight_layout()`, replace that one line with two lines:

```python
ax.set_xticks(range(len(fg_counts)))
ax.set_xticklabels(fg_counts.index, rotation=45, ha="right")
```

So this block:

```python
fig, ax = plt.subplots(figsize=(8, 4))
ax.bar(fg_counts.index, fg_counts.values)
ax.set_title("Feature Group Distribution (Section 2.2)")
ax.set_xlabel("Feature group")
ax.set_ylabel("Number of columns")
ax.set_xticklabels(fg_counts.index, rotation=45, ha="right")
plt.tight_layout()
```

becomes:

```python
fig, ax = plt.subplots(figsize=(8, 4))
ax.bar(fg_counts.index, fg_counts.values)
ax.set_title("Feature Group Distribution (Section 2.2)")
ax.set_xlabel("Feature group")
ax.set_ylabel("Number of columns")

ax.set_xticks(range(len(fg_counts)))
ax.set_xticklabels(fg_counts.index, rotation=45, ha="right")

plt.tight_layout()
```

That will silence the warning and keep the same visual.

*(Alternative if you ever want an even simpler pattern:)*

```python
for label in ax.get_xticklabels():
    label.set_rotation(45)
    label.set_ha("right")
```

But the first fix is perfectly fine.

---

## 2Ô∏è‚É£ Make the timestamp future-proof (optional but consistent)

At the bottom you have:

```python
"timestamp":          pd.Timestamp.utcnow(),
```

To stay consistent with the earlier deprecation fix you did (and be timezone-aware), change that to:

```python
from datetime import timezone  # at the top of your notebook if not already

# ...

"timestamp":          pd.Timestamp.now(timezone.utc),
```

This matches the pattern we used in other sections and avoids `utcnow` deprecation warnings down the line.

---

Other than those two tiny tweaks, this cell is in great shape, and the feature group counts table you showed looks totally reasonable for your Telco setup. ‚úÖ


